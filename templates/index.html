<!DOCTYPE html>
<html>
<head>
  <title>Song Picker</title>
  <link rel="stylesheet" href="/static/style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <h1>ğŸ¶ Pick a Song for Auggy Style</h1>

  <div style="text-align:center; margin-bottom: 15px;">
    <a href="/?sort=name">ğŸ”  Sort by Title</a> |
    <a href="/?sort=artist">ğŸ¤ Sort by Artist</a>
  </div>

  <div class="song-list">
    {% if songs %}
      {% for song in songs %}
        <div 
          class="song-card {% if song.selected %}gray{% else %}green{% endif %}" 
          onclick="selectSong({{ loop.index0 }}, '{{ song.name }}', {{ 'true' if song.selected else 'false' }})"
        >
          <strong>{{ song.name }}</strong>
          {% if song.artist %}<span class="artist-name">{{ song.artist }}</span>{% endif %}
        </div>
      {% endfor %}
    {% else %}
      <p style="text-align: center; color: #888;">No songs available yet. Add some in the Admin Panel.</p>
    {% endif %}
  </div>

  <div id="confirmation" style="display:none; text-align:center; margin-top: 30px;">
    <h2 id="selectedSong"></h2>
    <form method="POST" action="/submit" id="songForm">
      <input type="hidden" name="song_index" id="songIndex">
      <input type="hidden" name="tipped" id="tippedValue" value="false">
      <input type="text" name="name" placeholder="Your Name (optional)" style="margin-bottom: 15px;"><br>
      <button type="button" onclick="tipBand()">ğŸ’¸ Tip the Band</button>
      <button type="submit">ğŸµ Submit Song Request</button>
    </form>
  </div>

  <hr style="margin-top: 40px;">
  <div style="text-align: center;">
    <h3>ğŸ¤ Suggest a Song for the Next Show</h3>
    <form method="POST" action="/suggest">
      <input type="text" name="suggestion" id="suggestionInput" placeholder="Enter a song title" style="width: 80%; max-width: 300px; padding: 10px;"><br><br>
      <button type="submit" id="suggestBtn" disabled>â• Submit Suggestion</button>
    </form>
  </div>

  <div style="text-align: center; margin-top: 40px;">
    <a href="https://AuggyStyle.com" target="_blank" style="text-decoration: none; color: #0078d4;">
      ğŸŒ Visit AuggyStyle.com
    </a>
  </div>

  <div style="text-align: center; margin-top: 10px;">
    <a href="#" onclick="promptAdminLogin()" style="text-decoration: none; color: #0078d4;">
      ğŸ” Admin Login
    </a>
  </div>

  <script>
    function selectSong(index, name, isSelected) {
      if (isSelected) {
        const messages = [
          "â€œNice pick! Weâ€™ll queue it up â€” and nope, you canâ€™t pick it again ğŸ˜â€",
          "â€œSong selected. That oneâ€™s taken â€” no backsies!â€",
          "â€œGood taste â€” but it's already in the queue!â€",
          "â€œYouâ€™re too late â€” somebody else beat you to it!â€"
        ];
        const random = Math.floor(Math.random() * messages.length);
        alert(messages[random]);
        return;
      }

      document.querySelector('.song-list').style.display = "none";
      document.getElementById("confirmation").style.display = "block";
      document.getElementById("songIndex").value = index;
      document.getElementById("selectedSong").innerText = "ğŸµ You selected: " + name;
    }

    function tipBand() {
      document.getElementById("tippedValue").value = "true";
      window.open("https://venmo.com/AuggyStyle", "_blank");
    }

    function promptAdminLogin() {
      const pin = prompt("Enter Admin PIN:");
      if (pin) {
        window.location.href = `/admin?admin_pin=${encodeURIComponent(pin)}`;
      }
    }

    // Auto-refresh unless confirmation screen is active
    setInterval(() => {
      if (document.getElementById("confirmation").style.display !== "block") {
        window.location.reload();
      }
    }, 30000);

    // Suggestion form logic
    const suggestionInput = document.getElementById("suggestionInput");
    const suggestBtn = document.getElementById("suggestBtn");

    if (suggestionInput && suggestBtn) {
      suggestBtn.disabled = suggestionInput.value.trim() === "";

      suggestionInput.addEventListener("input", () => {
        suggestBtn.disabled = suggestionInput.value.trim() === "";
      });

      document.querySelector("form[action='/suggest']").addEventListener("submit", function (e) {
        e.preventDefault();

        fetch("/suggest", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: `suggestion=${encodeURIComponent(suggestionInput.value.trim())}`
        })
        .then(() => {
          suggestionInput.value = "";
          suggestBtn.disabled = true;

          const message = document.createElement("p");
          message.textContent = "âœ… Suggestion submitted!";
          message.style.color = "green";
          message.style.fontWeight = "bold";
          message.style.textAlign = "center";

          suggestBtn.parentElement.appendChild(message);

          setTimeout(() => {
            message.remove();
          }, 3000);
        });
      });
    }
  </script>
</body>
</html>
